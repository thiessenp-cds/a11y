<!doctype html>
<html lang="en">
  <head>
      <meta charset="utf-8" />
      <title>Drag and Drop</title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
  </head>
  <body>
    <main>
      <h1>Drag and Drop</h1>
      <div id="dragTarget">Drop Here</div>
      <br>
      <div>
        <a href="https://www.hawaiipictures.com">Image from  HawaiiPictures.com</a>
        <br>
        <img 
          draggable="true"
          id="dragSource"
          src="https://www.hawaiipictures.com/cdn/shop/t/4/assets/slide_1.jpg"
          width="300"
          height="300"
          > 
      </div>
    </main>
    <style>
      #dragTarget {
        width: 300px;
        height: 300px;
        padding: 1rem;
        border: 1px solid black;
        background-color: #aaa;
      }
    </style>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        // See: 
        // https://developer.mozilla.org/en-US/docs/Web/API/HTML_Drag_and_Drop_API

        const dragStartImg = new Image();
        dragStartImg.src = "https://www.hawaiipictures.com/cdn/shop/t/4/assets/slide_1.jpg";
        function handleDragStart(e) {
          e.dataTransfer.setDragImage(dragStartImg, 10, 10);    // 10=offset from cursor
          e.dataTransfer.setData("text/plain", e.target.id);    // dataTransfer property that holds the event's data
          //e.dataTransfer.effectAllowed = "copy";              // copy|move|link, only needs to be set on dragOver
        }

        function handleDragOver(e) {
          e.preventDefault();                                   // Required to allow drop
          e.dataTransfer.dropEffect = "copy";                   // move doesn't work?
          e.target.style.backgroundColor = "green";
        }

        function handleDragLeave(e) {
          e.target.style.backgroundColor = "";
        }

        function handleDrop(e) {
          const isLink = event.dataTransfer.types.includes("text/uri-list");
          if (isLink) { e.preventDefault(); }                   // Useful if a E.g. link to stop navigation
          const data = e.dataTransfer.getData("text");
          e.target.appendChild(document.getElementById(data));
          e.target.innerHTML += "Dropped";
        }

        function handleDragEnd(e) {
          if (e.target.parentElement) {
            e.target.parentElement.style.backgroundColor = "grey";
            console.log(e.target.parentElement);                // TODO: seems to only catch on a failed drop
          }
        } 
  
        const dragSourceEl = document.getElementById("dragSource");
        dragSourceEl.addEventListener("dragstart", handleDragStart);
        dragSourceEl.addEventListener("dragend", handleDragEnd);

        const dragTargetEl = document.getElementById("dragTarget");
        dragTargetEl.addEventListener("dragover", handleDragOver);
        dragTargetEl.addEventListener("dragleave", handleDragLeave);
        dragTargetEl.addEventListener("drop", handleDrop);      // To become a dropzone requires both drop and dragover
      });
    </script>
  </body>
</html>
